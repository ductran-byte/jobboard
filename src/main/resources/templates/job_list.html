<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
      th:replace="~{layout :: layout(~{::#jobListContent})}">
<head>
    <meta charset="UTF-8">
    <title>Jobs - JobBoard</title>
</head>
<body>
<div id="jobListContent">

    <!-- üîß CSS ri√™ng cho trang Job List -->
    <style>
        .salary-pill {
            display: inline-flex;
            min-width: 140px;          /* ‚úÖ k√≠ch th∆∞·ªõc ngang c·ªë ƒë·ªãnh */
            justify-content: center;
            padding: 4px 12px;
            border-radius: 999px;
            background-color: #fff7e6;
            border: 1px solid #ffe69c;
            color: #b8860b;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .sort-link {
            font-size: 0.75rem;
            margin-left: 4px;
            color: #6b7280;
            text-decoration: none;
        }

        .sort-link:hover {
            color: #0d6efd;
        }

        .job-table-title {
            font-weight: 600;
        }
    </style>

    <!-- üîπ Title + Add Job -->
    <section class="pt-4 pb-2">
        <div class="container d-flex justify-content-between align-items-center">
            <h2 class="mb-0">Job List</h2>
            <a href="/jobs/create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Job
            </a>
        </div>
    </section>

    <!-- üîç Thanh t√¨m ki·∫øm -->
    <section class="py-2">
        <div class="container">
            <form id="searchForm" class="row g-2 align-items-center"
                  method="get" th:action="@{/jobs}">
                <!-- Khi g√µ keyword m·ªõi th√¨ lu√¥n quay v·ªÅ trang 1 -->
                <input type="hidden" name="page" value="1"/>

                <!-- ‚úÖ gi·ªØ tr·∫°ng th√°i s·∫Øp x·∫øp hi·ªán t·∫°i -->
                <input type="hidden" name="sortField" th:value="${sortField}">
                <input type="hidden" name="sortDir" th:value="${sortDir}">

                <div class="col-md-6">
                    <input type="text"
                           id="keywordInput"
                           name="keyword"
                           class="form-control"
                           placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ, k·ªπ nƒÉng ho·∫∑c c√¥ng ty..."
                           th:value="${keyword}">
                </div>
            </form>

            <small class="text-muted d-block mt-1">
                üí° G√µ t·ª´ kho√°, d·ª´ng l·∫°i m·ªôt ch√∫t, h·ªá th·ªëng s·∫Ω t·ª± t√¨m ki·∫øm.
            </small>
        </div>
    </section>

    <!-- üìã Danh s√°ch jobs -->
    <section class="pb-5">
        <div class="container">
            <div class="card shadow-sm">
                <div class="card-body">

                    <table class="table table-hover align-middle">
                        <thead>
                        <tr>
                            <th class="job-table-title">
                                Title
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='title', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='title', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th class="job-table-title">
                                Company
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='company.name', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='company.name', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th class="job-table-title">
                                Location
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='location', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='location', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th class="job-table-title">
                                Type
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='jobType', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='jobType', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th class="job-table-title">
                                Salary
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='salary', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='salary', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th class="job-table-title">
                                Posted
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='postedDate', sortDir='asc')}">
                                    ‚ñ≤
                                </a>
                                <a class="sort-link"
                                   th:href="@{/jobs(page=1, keyword=${keyword}, sortField='postedDate', sortDir='desc')}">
                                    ‚ñº
                                </a>
                            </th>

                            <th width="160" class="job-table-title text-center">
                                Actions
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="job : ${jobs}">
                            <td>
                                <a th:href="@{/jobs/detail/{id}(id=${job.id})}"
                                   th:text="${job.title}"
                                   class="text-decoration-none fw-semibold text-primary"></a>
                            </td>
                            <td th:text="${job.company.name}"></td>
                            <td th:text="${job.location}"></td>
                            <td th:text="${job.jobType}"></td>
                            <td>
                                <div class="salary-pill"
                                     th:text="${job.salary != null and !#strings.isEmpty(job.salary) ? job.salary : 'Negotiable'}">
                                    Negotiable
                                </div>
                            </td>
                            <td th:text="${#temporals.format(job.postedDate, 'dd/MM/yyyy')}"></td>
                            <td class="text-center">
                                <a th:href="@{/jobs/edit/{id}(id=${job.id})}"
                                   class="btn btn-sm btn-outline-secondary me-1">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <a th:href="@{/jobs/delete/{id}(id=${job.id})}"
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('Xo√° job n√†y?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(jobs)}">
                            <td colspan="7" class="text-center text-muted">
                                Kh√¥ng t√¨m th·∫•y job n√†o.
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- üîÅ Ph√¢n trang -->
                    <nav th:if="${totalPages > 1}">
                        <ul class="pagination justify-content-center mt-3">
                            <li class="page-item"
                                th:classappend="${currentPage == 1} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/jobs(page=${currentPage - 1},
                                                    keyword=${keyword},
                                                    sortField=${sortField},
                                                    sortDir=${sortDir})}">
                                    Previous
                                </a>
                            </li>

                            <li class="page-item"
                                th:each="p : ${#numbers.sequence(1, totalPages)}"
                                th:classappend="${p == currentPage} ? 'active'">
                                <a class="page-link"
                                   th:href="@{/jobs(page=${p},
                                                    keyword=${keyword},
                                                    sortField=${sortField},
                                                    sortDir=${sortDir})}"
                                   th:text="${p}"></a>
                            </li>

                            <li class="page-item"
                                th:classappend="${currentPage == totalPages} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/jobs(page=${currentPage + 1},
                                                    keyword=${keyword},
                                                    sortField=${sortField},
                                                    sortDir=${sortDir})}">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>

                </div>
            </div>
        </div>
    </section>

    <!-- üß† Script auto search + focus -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('keywordInput');
            const form = document.getElementById('searchForm');
            if (!input || !form) return;

            // üî• Khi trang load xong, focus v√†o √¥ t√¨m ki·∫øm + ƒë∆∞a con tr·ªè v·ªÅ cu·ªëi chu·ªói
            input.focus();
            const val = input.value;
            input.setSelectionRange(val.length, val.length);

            let typingTimer;
            const DONE_TYPING_INTERVAL = 500; // 0.5s sau khi d·ª´ng g√µ th√¨ search

            input.addEventListener('keyup', function () {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(function () {
                    form.submit();
                }, DONE_TYPING_INTERVAL);
            });
        });
    </script>

</div>
</body>
</html>
