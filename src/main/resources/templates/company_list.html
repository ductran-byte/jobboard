<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
      th:replace="~{layout :: layout(~{::#companyListContent})}">
<head>
    <meta charset="UTF-8">
    <title>Companies - JobBoard</title>
</head>
<body>
<div id="companyListContent">

    <!-- üîß CSS ri√™ng cho trang Company List (gi·ªëng Job List) -->
    <style>
        .company-table-title {
            font-weight: 600;
        }

        .sort-link {
            font-size: 0.75rem;
            margin-left: 4px;
            color: #6b7280;
            text-decoration: none;
        }

        .sort-link:hover {
            color: #0d6efd;
        }
    </style>

    <!-- üîπ Title + Add Company (gi·ªëng Job List) -->
    <section class="pt-4 pb-2">
        <div class="container d-flex justify-content-between align-items-center">
            <h2 class="mb-0">Company List</h2>
            <a href="/companies/create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Company
            </a>
        </div>
    </section>

    <!-- üîî Flash message -->
    <section class="pb-1">
        <div class="container">
            <div th:if="${message != null && !#strings.isEmpty(message)}"
                 class="alert alert-success py-2 mb-2">
                <span th:text="${message}"></span>
            </div>
        </div>
    </section>

    <!-- üîç Thanh t√¨m ki·∫øm (auto search gi·ªëng jobs) -->
    <section class="py-2">
        <div class="container">
            <form id="searchFormCompanies"
                  class="row g-2 align-items-center"
                  method="get"
                  th:action="@{/companies}">
                <!-- Khi g√µ keyword m·ªõi th√¨ lu√¥n quay v·ªÅ trang 1 -->
                <input type="hidden" name="page" value="1"/>

                <div class="col-md-6">
                    <input type="text"
                           id="keywordInputCompanies"
                           name="keyword"
                           class="form-control"
                           placeholder="Search by company name, email or website..."
                           th:value="${keyword}">
                </div>

            </form>

            <small class="text-muted d-block mt-1">
                üí° Type keyword and pause a bit, the list will auto filter.
            </small>
        </div>
    </section>

    <!-- üìã B·∫£ng danh s√°ch company (card gi·ªëng Job List) -->
    <section class="pb-5">
        <div class="container">
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table mb-0 align-middle table-hover">
                        <thead class="table-light">
                        <tr>
                            <th class="company-table-title" style="width: 60px;">#</th>
                            <th class="company-table-title">Name</th>
                            <th class="company-table-title">Email</th>
                            <th class="company-table-title">Website</th>
                            <th class="company-table-title">Address</th>
                            <th class="company-table-title text-end" style="width: 160px;">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="c, stat : ${companies}">
                            <td th:text="${stat.index + 1}">1</td>
                            <td>
                                <a th:href="@{/companies/{id}(id=${c.id})}"
                                   th:text="${c.name}"
                                   class="text-decoration-none fw-semibold text-primary"></a>
                            </td>
                            <td th:text="${c.email}">email@example.com</td>
                            <td>
                                <a th:href="${c.website}"
                                   th:text="${c.website}"
                                   target="_blank"
                                   class="small text-decoration-none"></a>
                            </td>
                            <td th:text="${c.address}">Address</td>
                            <td class="text-end">
                                <a th:href="@{/companies/edit/{id}(id=${c.id})}"
                                   class="btn btn-sm btn-outline-secondary me-1">
                                    <i class="bi bi-pencil-square"></i>
                                </a>

                                <!-- üóëÔ∏è Xo√° company + jobs (x√°c nh·∫≠n) -->
                                <a th:href="@{/companies/delete/{id}(id=${c.id})}"
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° company n√†y v√† to√†n b·ªô job thu·ªôc v·ªÅ n√≥ kh√¥ng?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(companies)}">
                            <td colspan="6" class="text-center text-muted py-4">
                                No companies found.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- üîÅ Ph√¢n trang (gi·ªØ nguy√™n logic c≈©, style gi·ªëng job list) -->
            <nav th:if="${totalPages > 1}" class="mt-3">
                <ul class="pagination justify-content-center mb-0">
                    <li class="page-item"
                        th:classappend="${currentPage == 1} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/companies(page=${currentPage - 1}, keyword=${keyword})}">
                            Previous
                        </a>
                    </li>

                    <li class="page-item"
                        th:each="p : ${#numbers.sequence(1, totalPages)}"
                        th:classappend="${p == currentPage} ? 'active'">
                        <a class="page-link"
                           th:text="${p}"
                           th:href="@{/companies(page=${p}, keyword=${keyword})}"></a>
                    </li>

                    <li class="page-item"
                        th:classappend="${currentPage == totalPages} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/companies(page=${currentPage + 1}, keyword=${keyword})}">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>

    <!-- üß† Script auto search + auto focus (gi·ªëng jobs) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('keywordInputCompanies');
            const form = document.getElementById('searchFormCompanies');
            if (!input || !form) return;

            // Focus √¥ t√¨m ki·∫øm + ƒë∆∞a con tr·ªè v·ªÅ cu·ªëi chu·ªói
            input.focus();
            const val = input.value;
            input.setSelectionRange(val.length, val.length);

            let typingTimer;
            const DONE_TYPING_INTERVAL = 500; // 0.5s sau khi d·ª´ng g√µ th√¨ search

            input.addEventListener('keyup', function () {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(function () {
                    form.submit();
                }, DONE_TYPING_INTERVAL);
            });
        });
    </script>

</div>
</body>
</html>
